<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Subtitle Matcher</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #1a1a1a; color: #e0e0e0; margin: 0; padding: 2rem; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background-color: #2c2c2c; padding: 2rem 3rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 600px; width: 100%; }
        h1 { color: #4ade80; text-align: center; margin-bottom: 1rem; }
        p { text-align: center; color: #a0a0a0; margin-bottom: 2rem; }
        .language-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .lang-option { background-color: #3a3a3a; padding: 0.75rem; border-radius: 8px; display: flex; align-items: center; cursor: pointer; transition: background-color 0.2s; }
        .lang-option:hover { background-color: #4a4a4a; }
        .lang-option input { margin-right: 0.75rem; width: 18px; height: 18px; }
        .button-container { text-align: center; }
        button { background-color: #4ade80; color: #1a1a1a; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #6ee7b7; }
        #install-link-container { margin-top: 1.5rem; text-align: center; }
        #install-link { color: #4ade80; font-weight: bold; text-decoration: none; word-break: break-all; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Configure Your Addon</h1>
        <p>Select your preferred languages. <span style="color:#4ade80;font-weight:bold;">Subtitles marked <span style='background:#222;padding:2px 8px;border-radius:6px;color:#fff;font-size:0.95em;'>ðŸŽ¯ Perfect Match</span> are hash-matched and guaranteed to be in sync.</span></p>
        <div style="margin:2rem 0 1rem 0;text-align:center;">
            <span style="display:inline-block;background:#222;padding:6px 16px;border-radius:8px;color:#4ade80;font-weight:bold;font-size:1.1em;">
                ðŸŽ¯ Perfect Match = Hash-matched, guaranteed sync
            </span>
        </div>

        <div class="language-grid" id="languageGrid"></div>

        <div class="button-container">
            <button onclick="generateInstallLink()">Generate & Copy Install Link</button>
        </div>

        <div id="stremio-install-link-container" style="display:none; margin-top:1.5rem; text-align:center;">
            <a href="#" id="stremio-install-link" style="background:#4ade80;color:#1a1a1a;padding:0.75rem 1.5rem;border-radius:8px;font-weight:bold;text-decoration:none;">Install in Stremio</a>
        </div>

        <div id="install-link-container" style="display:none;">
            <a href="#" id="install-link">Click here to install in Stremio</a>
        </div>
    </div>

    <script>
        const languages = [
            { code: 'en', name: 'English' }, { code: 'es', name: 'Spanish' }, { code: 'fr', name: 'French' },
            { code: 'de', name: 'German' }, { code: 'it', name: 'Italian' }, { code: 'pt', name: 'Portuguese' },
            { code: 'ru', name: 'Russian' }, { code: 'tr', name: 'Turkish' }, { code: 'nl', name: 'Dutch' },
            { code: 'sv', name: 'Swedish' }, { code: 'no', name: 'Norwegian' }, { code: 'da', name: 'Danish' }
        ];

        const grid = document.getElementById('languageGrid');

        // --- Parse config from URL if present ---
        function getConfigFromUrl() {
            const match = window.location.pathname.match(/^\/(.+)\/configure$/);
            if (match && match[1]) {
                try {
                    const decoded = atob(match[1]);
                    return JSON.parse(decoded);
                } catch (e) { return null; }
            }
            return null;
        }
        const userConfig = getConfigFromUrl();
        const selectedLangs = userConfig && Array.isArray(userConfig.languages) ? userConfig.languages : ['en'];

        languages.forEach(lang => {
            const label = document.createElement('label');
            label.className = 'lang-option';
            const checked = selectedLangs.includes(lang.code) ? 'checked' : '';
            label.innerHTML = `<input type="checkbox" name="language" value="${lang.code}" ${checked}> ${lang.name}`;
            grid.appendChild(label);
        });

        function generateInstallLink() {
            const selectedLanguages = Array.from(document.querySelectorAll('input[name="language"]:checked')).map(cb => cb.value);

            if (selectedLanguages.length === 0) {
                alert('Please select at least one language.');
                return;
            }

            const config = { languages: selectedLanguages };
            const baseUrl = window.location.origin;
            const configStr = btoa(JSON.stringify(config)); // Encode config as Base64
            const installUrl = `${baseUrl}/${configStr}/manifest.json`;

            // Show plain URL for manual copy-paste
            const installLinkElement = document.getElementById('install-link');
            installLinkElement.href = installUrl;
            installLinkElement.textContent = installUrl;
            document.getElementById('install-link-container').style.display = 'block';

            // Show stremio:// install link for direct install
            const stremioInstallLink = document.getElementById('stremio-install-link');
            stremioInstallLink.href = `stremio://${installUrl.replace(/^https?:\/\//, '')}`;
            document.getElementById('stremio-install-link-container').style.display = 'block';

            navigator.clipboard.writeText(installUrl).then(() => {
                alert('Install link copied to clipboard! You can also click "Install in Stremio" for direct install on desktop/mobile.');
            }).catch(err => {
                console.error('Could not copy text: ', err);
                alert('Could not copy link. Please manually copy the link shown below.');
            });
        }
    </script>
</body>
</html>
