<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Subtitle Matcher</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #1a1a1a; color: #e0e0e0; margin: 0; padding: 2rem; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background-color: #2c2c2c; padding: 2rem 3rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 600px; width: 100%; }
        h1 { color: #4ade80; text-align: center; margin-bottom: 1rem; }
        p { text-align: center; color: #a0a0a0; margin-bottom: 2rem; }
        .language-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .lang-option { background-color: #3a3a3a; padding: 0.75rem; border-radius: 8px; display: flex; align-items: center; cursor: pointer; transition: background-color 0.2s; }
        .lang-option:hover { background-color: #4a4a4a; }
        .lang-option input { margin-right: 0.75rem; width: 18px; height: 18px; }
        .button-container { text-align: center; }
        button { background-color: #4ade80; color: #1a1a1a; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #6ee7b7; }
        #install-link-container { margin-top: 1.5rem; text-align: center; }
        #install-link { color: #4ade80; font-weight: bold; text-decoration: none; word-break: break-all; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Configure Your Addon</h1>
        <p>Select your preferred languages. The addon will show a checkmark [字幕 ✓] for torrents that have a perfect subtitle match in these languages.</p>

        <div class="language-grid" id="languageGrid"></div>

        <div class="button-container">
            <button onclick="generateInstallLink()">Generate & Copy Install Link</button>
        </div>

        <div id="install-link-container" style="display:none;">
            <a href="#" id="install-link">Click here to install in Stremio</a>
        </div>
    </div>

    <script>
        const languages = [
            { code: 'en', name: 'English' }, { code: 'es', name: 'Spanish' }, { code: 'fr', name: 'French' },
            { code: 'de', name: 'German' }, { code: 'it', name: 'Italian' }, { code: 'pt', name: 'Portuguese' },
            { code: 'ru', name: 'Russian' }, { code: 'tr', name: 'Turkish' }, { code: 'nl', name: 'Dutch' },
            { code: 'sv', name: 'Swedish' }, { code: 'no', name: 'Norwegian' }, { code: 'da', name: 'Danish' }
        ];

        const grid = document.getElementById('languageGrid');
        languages.forEach(lang => {
            const label = document.createElement('label');
            label.className = 'lang-option';
            label.innerHTML = `<input type="checkbox" name="language" value="${lang.code}" ${lang.code === 'en' ? 'checked' : ''}> ${lang.name}`;
            grid.appendChild(label);
        });

        function generateInstallLink() {
            const selectedLanguages = Array.from(document.querySelectorAll('input[name="language"]:checked')).map(cb => cb.value);

            if (selectedLanguages.length === 0) {
                alert('Please select at least one language.');
                return;
            }

            const config = { languages: selectedLanguages };
            const baseUrl = window.location.origin;
            const configStr = btoa(JSON.stringify(config)); // Encode config as Base64
            const installUrl = `${baseUrl}/${configStr}/manifest.json`;

            const installLinkElement = document.getElementById('install-link');
            installLinkElement.href = `stremio://${installUrl}`;
            document.getElementById('install-link-container').style.display = 'block';

            navigator.clipboard.writeText(installUrl).then(() => {
                alert('Install link copied to clipboard! Paste it into the Stremio search bar if clicking does not work.');
            }).catch(err => {
                console.error('Could not copy text: ', err);
                alert('Could not copy link. Please manually copy the link shown below.');
            });
        }
    </script>
</body>
</html>
